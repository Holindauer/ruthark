module BFieldElement = import "BFieldElement"
type BFieldElement = BFieldElement.BFieldElement
module Utils = import "Utils"
-- STATE_SIZE
let m = 16i64
-- RATE
let rate = 10i64
let rescue_prime_digest_length = 5i64


type Parameters [m_MDS] [n_MDS] [c_len] = {
    p : u64,
    m : i64,
    capacity : i64,
    rate : i64,
    security_level : u64,
    alpha : BFieldElement,
    alphainv : BFieldElement,
    N : i32,
    MDS : [m_MDS][n_MDS]BFieldElement,
    round_constants: [c_len]BFieldElement
}


type DefaultParameters = Parameters [m] [m] [256]


let round_constants_u64: [256]u64 =
[3006656781416918236,
 4369161505641058227,
 6684374425476535479,
 15779820574306927140,
 9604497860052635077,
 6451419160553310210,
 16926195364602274076,
 6738541355147603274,
 13653823767463659393,
 16331310420018519380,
 10921208506902903237,
 5856388654420905056,
 180518533287168595,
 6394055120127805757,
 4624620449883041133,
 4245779370310492662,
 11436753067664141475,
 9565904130524743243,
 1795462928700216574,
 6069083569854718822,
 16847768509740167846,
 4958030292488314453,
 6638656158077421079,
 7387994719600814898,
 1380138540257684527,
 2756275326704598308,
 6162254851582803897,
 4357202747710082448,
 12150731779910470904,
 3121517886069239079,
 14951334357190345445,
 11174705360936334066,
 17619090104023680035,
 9879300494565649603,
 6833140673689496042,
 8026685634318089317,
 6481786893261067369,
 15148392398843394510,
 11231860157121869734,
 2645253741394956018,
 15345701758979398253,
 1715545688795694261,
 3419893440622363282,
 12314745080283886274,
 16173382637268011204,
 2012426895438224656,
 6886681868854518019,
 9323151312904004776,
 14061124303940833928,
 14720644192628944300,
 3643016909963520634,
 15164487940674916922,
 18095609311840631082,
 17450128049477479068,
 13770238146408051799,
 959547712344137104,
 12896174981045071755,
 15673600445734665670,
 5421724936277706559,
 15147580014608980436,
 10475549030802107253,
 9781768648599053415,
 12208559126136453589,
 14883846462224929329,
 4104889747365723917,
 748723978556009523,
 1227256388689532469,
 5479813539795083611,
 8771502115864637772,
 16732275956403307541,
 4416407293527364014,
 828170020209737786,
 12657110237330569793,
 6054985640939410036,
 4339925773473390539,
 12523290846763939879,
 6515670251745069817,
 3304839395869669984,
 13139364704983394567,
 7310284340158351735,
 10864373318031796808,
 17752126773383161797,
 1934077736434853411,
 12181011551355087129,
 16512655861290250275,
 17788869165454339633,
 12226346139665475316,
 521307319751404755,
 18194723210928015140,
 11017703779172233841,
 15109417014344088693,
 16118100307150379696,
 16104548432406078622,
 10637262801060241057,
 10146828954247700859,
 14927431817078997000,
 8849391379213793752,
 14873391436448856814,
 15301636286727658488,
 14600930856978269524,
 14900320206081752612,
 9439125422122803926,
 17731778886181971775,
 11364016993846997841,
 11610707911054206249,
 16438527050768899002,
 1230592087960588528,
 11390503834342845303,
 10608561066917009324,
 5454068995870010477,
 13783920070953012756,
 10807833173700567220,
 8597517374132535250,
 17631206339728520236,
 8083932512125088346,
 10460229397140806011,
 16904442127403184100,
 15806582425540851960,
 8002674967888750145,
 7088508235236416142,
 2774873684607752403,
 11519427263507311324,
 14949623981479468161,
 18169367272402768616,
 13279771425489376175,
 3437101568566296039,
 11820510872362664493,
 13649520728248893918,
 13432595021904865723,
 12153175375751103391,
 16459175915481931891,
 14698099486055505377,
 14962427686967561007,
 10825731681832829214,
 12562849212348892143,
 18054851842681741827,
 16866664833727482321,
 10485994783891875256,
 8074668712578030015,
 7502837771635714611,
 8326381174040960025,
 1299216707593490898,
 12092900834113479279,
 10147133736028577997,
 12103660182675227350,
 16088613802080804964,
 10323305955081440356,
 12814564542614394316,
 9653856919559060601,
 10390420172371317530,
 7831993942325060892,
 9568326819852151217,
 6299791178740935792,
 12692828392357621723,
 10331476541693143830,
 3115340436782501075,
 17456578083689713056,
 12924575652913558388,
 14365487216177868031,
 7211834371191912632,
 17610068359394967554,
 646302646073569086,
 12437378932700222679,
 2758591586601041336,
 10952396165876183059,
 8827205511644136726,
 17572216767879446421,
 12516044823385174395,
 6380048472179557105,
 1959389938825200414,
 257915527015303758,
 4942451629986849727,
 1698530521870297461,
 1802136667015215029,
 6353258543636931941,
 13791525219506237119,
 7093082295632492630,
 15409842367405634814,
 2090232819855225051,
 13926160661036606054,
 389467431021126699,
 4736917413147385608,
 6217341363393311211,
 4366302820407593918,
 12748238635329332117,
 7671680179984682360,
 17998193362025085453,
 432899318054332645,
 1973816396170253277,
 607886411884636526,
 15080416519109365682,
 13607062276466651973,
 2458254972975404730,
 15323169029557757131,
 10953434699543086460,
 13995946730291266219,
 12803971247555868632,
 3974568790603251423,
 10629169239281589943,
 2058261494620094806,
 15905212873859894286,
 11221574225004694137,
 15430295276730781380,
 10448646831319611878,
 7559293484620816204,
 15679753002507105741,
 6043747003590355195,
 3404573815097301491,
 13392826344874185313,
 6464466389567159772,
 8932733991045074013,
 6565970376680631168,
 7050411859293315754,
 9763347751680159247,
 3140014248604700259,
 5621238883761074228,
 12664766603293629079,
 6533276137502482405,
 914829860407409680,
 14599697497440353734,
 16400390478099648992,
 1619185634767959932,
 16420198681440130663,
 1331388886719756999,
 1430143015191336857,
 14618841684410509097,
 1870494251298489312,
 3783117677312763499,
 16164771504475705474,
 6996935044500625689,
 4356994160244918010,
 13579982029281680908,
 8835524728424198741,
 13281017722683773148,
 2669924686363521592,
 15020410046647566094,
 9534143832529454683,
 156263138519279564,
 17421879327900831752,
 9524879102847422379,
 5120021146470638642,
 9588770058331935449,
 1501841070476096181,
 5687728871183511192,
 16091855309800405887,
 17307425956518746505,
 1162636238106302518,
 8756478993690213481,
 6898084027896327288,
 8485261637658061794,
 4169208979833913382,
 7776158701576840241,
 13861841831073878156,
 4896983281306117497,
 6056805506026814259,
 15706891000994288769]


let MDS_u64: [16][16]u64 =
[[5910257123858819639,
  3449115226714951713,
  16770055338049327985,
  610399731775780810,
  7363016345531076300,
  16174724756564259629,
  8736587794472183152,
  12699016954477470956,
  13948112026909862966,
  18015813124076612987,
  9568929147539067610,
  14859461777592116402,
  18169364738825153183,
  18221568702798258352,
  1524268296724555606,
  5538821761600],
  [1649528676200182784,
  336497118937017052,
  15805000027048028625,
  15709375513998678646,
  14837031240173858084,
  11366298206428370494,
  15698532768527519720,
  5911577595727321095,
  16676030327621016157,
  16537624251746851423,
  13325141695736654367,
  9337952653454313447,
  9090375522091353302,
  5605636660979522224,
  6357222834896114791,
  7776871531164456679],
  [8264739868177574620,
  12732288338686680125,
  13022293791945187811,
  17403057736098613442,
  2871266924987061743,
  13286707530570640459,
  9229362695439112266,
  815317759014579856,
  7447771153889267897,
  2209002535000750347,
  3280506473249596174,
  13756142018694965622,
  10518080861296830621,
  16578355848983066277,
  12732532221704648123,
  3426526797578099186],
  [8563516248221808333,
  13079317959606236131,
  15645458946300428515,
  9958819147895829140,
  13028053188247480206,
  6789511720078828478,
  6583246594815170294,
  4423695887326249884,
  9751139665897711642,
  10039202025292797758,
  12208726994829996150,
  6238795140281096003,
  9113696057226188857,
  9898705245385052191,
  4213712701625520075,
  8038355032286280912],
  [426685147605824917,
  7673465577918025498,
  8452867379070564008,
  10827610229277395180,
  16155539332955658546,
  1575428636717115288,
  8765972548498757598,
  8405996249707890526,
  14855028677418679455,
  17878170012428694685,
  16572621079016066883,
  5311046098447994501,
  10635376800783355348,
  14205668690430323921,
  1181422971831412672,
  4651053123208915543],
  [12465667489477238576,
  7300129031676503132,
  13458544786180633209,
  8946801771555977477,
  14203890406114400141,
  8219081892380458635,
  6035067543134909245,
  15140374581570897616,
  4514006299509426029,
  16757530089801321524,
  13202061911440346802,
  11227558237427129334,
  315998614524336401,
  11280705904396606227,
  5798516367202621128,
  17154761698338453414],
  [13574436947400004837,
  3126509266905053998,
  10740979484255925394,
  9273322683773825324,
  15349096509718845737,
  14694022445619674948,
  8733857890739087596,
  3198488337424282101,
  9521016570828679381,
  11267736037298472148,
  14825280481028844943,
  1326588754335738002,
  6200834522767914499,
  1070210996042416038,
  9140190343656907671,
  15531381283521001952],
  [253143295675927354,
  11977331414401291539,
  13941376566367813256,
  469904915148256197,
  10873951860155749104,
  3939719938926157877,
  2271392376641547055,
  4725974756185387075,
  14827835543640648161,
  17663273767033351157,
  12440960700789890843,
  16589620022628590428,
  12838889473653138505,
  11170336581460183657,
  7583333056198317221,
  6006908286410425140],
  [15648567098514276013,
  188901633101859949,
  12256163716419861419,
  17319784688409668747,
  9648971065289440425,
  11370683735445551679,
  11265203235776280908,
  1737672785338087677,
  5225587291780939578,
  4739055740469849012,
  1212344601223444182,
  12958616893209019599,
  7922060480554370635,
  14661420107595710445,
  11744359917257111592,
  9674559564931202709],
  [8326110231976411065,
  16856751238353701757,
  7515652322254196544,
  2062531989536141174,
  3875321171362100965,
  1164854003752487518,
  3997098993859160292,
  4074090397542250057,
  3050858158567944540,
  4568245569065883863,
  14559440781022773799,
  5401845794552358815,
  6544584366002554176,
  2511522072283652847,
  9759884967674698659,
  16411672358681189856],
  [11392578809073737776,
  8013631514034873271,
  11439549174997471674,
  6373021446442411366,
  12491600135569477757,
  1017093281401495736,
  663547836518863091,
  16157302719777897692,
  11208801522915446640,
  10058178191286215107,
  5521712058210208094,
  3611681474253815005,
  4864578569041337696,
  12270319000993569289,
  7347066511426336318,
  6696546239958933736],
  [3335469193383486908,
  12719366334180058014,
  14123019207894489639,
  11418186023060178542,
  2042199956854124583,
  17539253100488345226,
  16240833881391672847,
  11712520063241304909,
  6456900719511754234,
  1819022137223501306,
  7371152900053879920,
  6521878675261223812,
  2050999666988944811,
  8262038465464898064,
  13303819303390508091,
  12657292926928303663],
  [8794128680724662595,
  4068577832515945116,
  758247715040138478,
  5600369601992438532,
  3369463178350382224,
  13763645328734311418,
  9685701761982837416,
  2711119809520557835,
  11680482056777716424,
  10958223503056770518,
  4168390070510137163,
  10823375744683484459,
  5613197991565754677,
  11781942063118564684,
  9352512500813609723,
  15997830646514778986],
  [7407352006524266457,
  15312663387608602775,
  3026364159907661789,
  5698531403379362946,
  2544271242593770624,
  13104502948897878458,
  7840062700088318710,
  6028743588538970215,
  6144415809411296980,
  468368941216390216,
  3638618405705274008,
  11105401941482704573,
  1850274872877725129,
  1011155312563349004,
  3234620948537841909,
  3818372677739507813],
  [4863130691592118581,
  8942166964590283171,
  3639677194051371072,
  15477372418124081864,
  10322228711752830209,
  9139111778956611066,
  202171733050704358,
  11982413146686512577,
  11001000478006340870,
  5491471715020327065,
  6969114856449768266,
  11088492421847219924,
  12913509272810999025,
  17366506887360149369,
  7036328554328346102,
  11139255730689011050],
  [2844974929907956457,
  6488525141985913483,
  2860098796699131680,
  10366343151884073105,
  844875652557703984,
  1053177270393416978,
  5189466196833763142,
  1024738234713107670,
  8846741799369572841,
  14490406830213564822,
  10577371742628912722,
  3276210642025060502,
  2605621719516949928,
  5417148926702080639,
  11100652475866543814,
  5247366835775169839]]


def default_parameters: DefaultParameters = {
  p = BFieldElement.prime,
  m = m,
  capacity = 6i64,
  rate = rate,
  security_level = 160u64,
  alpha = BFieldElement.U64 7,
  alphainv = BFieldElement.U64 10540996611094048183,
  N = 8i32,
  MDS = Utils.map2d BFieldElement.U64 MDS_u64 :> [m][m]BFieldElement,
  round_constants = map BFieldElement.U64 round_constants_u64
}
